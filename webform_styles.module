<?php

/**
 * Implements hook_node_load
 */
function webform_styles_node_load($nodes, $types)
{
    // Iterate the node list
    foreach ($nodes as $key => $node) {
        $results = db_select('webform_component')
                      ->fields('webform_component', array('webform_styles', 'cid'))
                      ->condition('nid', $node->nid, '=')
                      ->execute();

                        $styles = array();
                        while ($record = $results->fetchAssoc()) {
                            $styles[$record['cid']] = $record['webform_styles'];
                        }

                        // Add the webform components into the node to later render them
                        $node->webform_styles = $styles;
                    }
}

/**
 * Implements hook_webform_component_render_alter
 */
function webform_styles_webform_component_render_alter(&$element, &$component) {
  if($component['webform_styles']) {
    // Create the style array attribute if it doesn't exists
    if(!isset($element['#attributes']['style'])) {
      $element['#attributes']['style'] = array();
    }

    $element['#attributes']['style'][] = $component['webform_styles'];
  }
}

/**
 * Implements hook_form_webform_component_edit_form_alter
 */
function webform_styles_form_webform_component_edit_form_alter(&$form, $component)
{
    $form['webform_styles'] = array(
      '#type' => 'fieldset',
      '#title' => t('Inline styles'),
      '#collapsible' => true,
      '#collapsed' => false,
      '#weight' => 5,
      'style' => array(
          '#type' => 'textfield',
          '#title' => t('Style'),
          '#description' => t('Specify inline styles to be used on the form field'),
          '#size' => 26,
          '#maxlength' => 255,
          '#weight' => 1,
      ),
  );
}

/**
 * Implements webform_component_update
 */
function webform_styles_webform_component_update($component)
{
    if (isset($component['webform_styles']['style'])) {
        $result = db_update('webform_component')
                ->fields(array(
                    'webform_styles'=> $component['webform_styles']['style'],
                ))
                ->condition('nid', (int) $component['nid'], '=')
                ->condition('cid', (int) $component['cid'], '=')
                ->execute();
    }
}

/**
 * Implements webform_component_insert
 */
function webform_styles_webform_component_insert($component)
{
    webform_styles_webform_component_update($component);
}
